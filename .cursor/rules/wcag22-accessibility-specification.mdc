# WCAG 2.2 アクセシビリティ仕様書自動生成ルール

このルールは、任意のUIコンポーネントに対してWCAG 2.2準拠のアクセシビリティ仕様書を自動生成するための指示を定義します。

## 適用範囲

- `packages/component-ui/src` 配下のユーザー向け公開コンポーネント
- 新規作成時またはアクセシビリティ要件の見直し時

## 出力ファイル

- **配置**: `docs/component/` 配下
- **命名**: `[*component-name*]-accessibility-specification.md`
- **例**: `button-accessibility-specification.md`

## 生成プロセス

### 1. コンポーネント分析

対象コンポーネントの以下の特性を分析：

- **操作特性**: クリック/タップ、キーボード操作、状態変化
- **視覚特性**: 色、コントラスト、サイズ、フォーカス表示
- **情報伝達**: ラベル、アイコン、テキスト、状態表示
- **インタラクション**: フォーカス管理、イベント処理、アクセシビリティ属性

### 2. WCAG 2.2 成功基準の抽出

以下の4原則に基づいて関連する成功基準を抽出：

#### 知覚可能 (Perceivable)

- 1.1.1 非テキストコンテンツ
- 1.3.1 情報及び関係性
- 1.4.1 色の使用
- 1.4.3 コントラスト（最小）
- 1.4.6 コントラスト（強化）
- 1.4.9 文字画像（例外なし）
- 1.4.10 リフロー
- 1.4.11 非テキストのコントラスト

#### 操作可能 (Operable)

- 2.1.1 キーボード
- 2.1.2 キーボードトラップなし
- 2.4.3 フォーカス順序
- 2.4.7 フォーカス可視
- 2.4.11 フォーカス外観（最小）※WCAG 2.2追加
- 2.4.12 フォーカスの不遮蔽（最小）※WCAG 2.2追加
- 2.4.13 フォーカス外観（強化）
- 2.5.2 ポインターのキャンセル
- 2.5.3 ラベル名
- 2.5.5 ターゲットサイズ（強化）
- 2.5.7 ドラッグ操作※WCAG 2.2追加
- 2.5.8 ターゲットサイズ（最小）※WCAG 2.2追加

#### 理解可能 (Understandable)

- 3.2.1 フォーカス時
- 3.2.2 入力時
- 3.2.5 要求による変化
- 3.3.2 ラベル又は説明

#### 堅牢 (Robust)

- 4.1.2 名前・役割・値
- 4.1.3 ステータスメッセージ

### 3. 要件の実装観点への変換

各成功基準を開発者が判断できる具体的な要件に変換：

```typescript
// 例: 2.5.3 ラベル名
// 元: "視覚的に提示されるラベルと、プログラムによる決定されたラベルが一致する"
// 変換後: "視覚ラベルの先頭とaria-labelの先頭を一致させる"
```

### 4. 確認方法の分類

各項目を以下の3つに分類：

- **Vitest**: 既存のテストフレームワークで自動テスト可能
- **外部ツール**: 専用ツール（WebAIM Contrast Checker、axe-core等）が必要
- **手動テスト**: 人間による視覚的確認やユーザビリティテストが必要

## 出力フォーマット

### 必須セクション構成

```markdown
# [コンポーネント名] コンポーネント アクセシビリティ仕様書

## 目次

1. [概要](#概要)
2. [WCAG 2.2 チェックリスト](#wcag-22-チェックリスト)
3. [チェックリスト作成プロセス](#チェックリスト作成プロセス)
4. [実装状況の確認方法](#実装状況の確認方法)
5. [更新履歴](#更新履歴)
```

### 1. 概要セクション

以下の内容を含める：

- コンポーネントの目的・操作特性の簡潔な説明
- WCAG 2.2対応の意図（知覚可能・操作可能・理解可能・堅牢の4原則）
- A/AA/AAA 各レベルの対象範囲と達成目標
- テスト分類（Vitest / 外部ツール / 手動）の統計
- 確認状況の統計（確認済み/未確認/未対応/要改善）

### 2. WCAG 2.2 チェックリスト

#### 表形式の要件

| 成功基準 | レベル | 要件 | 確認状況 | 確認方法 | ツール分類 |

- 4原則（知覚可能・操作可能・理解可能・堅牢）で区分
- 各成功基準ごとに以下を明記：
  - 成功基準番号・タイトル（例：1.4.3 コントラスト（最小））
  - 適用レベル（A/AA/AAA）
  - 要件（開発者視点での要約）
  - 確認状況（✅ / ❓ / ❌ / ⚠️）
  - 確認方法（テスト内容や確認手段）
  - ツール分類（Vitest / 外部ツール / 手動）

#### 凡例の記載

セクション末尾に以下を必ず含める：

- 確認状況の凡例
- ツール分類の凡例
- AAAレベルの扱い（推奨項目）

### 3. チェックリスト作成プロセス

以下のステップを必ず説明：

| ステップ    | 内容                                                             |
| ----------- | ---------------------------------------------------------------- |
| 出典        | WCAG 2.2 公式文書および Understanding Docs                       |
| 抽出条件    | コンポーネントの特性に応じた選定（操作性、視認性、状態変化など） |
| 選定理由    | なぜその項目を含めたのか（ユーザー体験・支援技術との関係）       |
| 2.2追加項目 | 2.4.11, 2.4.12, 2.5.7, 2.5.8 などを明示                          |
| 実装再構成  | React/HTMLに落とし込む際の判断基準                               |
| 対象レベル  | A/AA/AAAの優先度を説明                                           |
| 参考文献    | W3C, WAI-ARIA, Gov.uk, Material Design等                         |

### 4. 実装状況の確認方法

以下の分類で整理：

- **自動テスト可能項目**
- **手動テスト必要項目**
- **AAAレベル確認項目**

各項目に以下を含める：

- テスト観点
- チェック内容
- 使用ツール（Vitest / axe-core / Contrast Checker など）

### 5. 更新履歴

| 日付 | 内容 | 担当者 |

初回は「新規作成」、以降は更新内容を追記。

## 記述ルール

### 文体・表記

- **言語**: 日本語で記述
- **文体**: 専門家向けの正確でフォーマルな文体
- **絵文字**: 使用しない
- **HTMLタグ・ARIA属性・コード**: バッククォート（`）で囲む
- **数値基準**: コントラスト比・サイズは明示
- **WCAG 2.2追加項目**: 強調表示する

### 確認状況の記号

- ✅ **確認済み**: テスト実施済み、要件を満たしている
- ❓ **未確認**: テスト未実施、確認が必要
- ❌ **未対応**: テスト実施済み、要件を満たしていない
- ⚠️ **要改善**: テスト実施済み、一部改善が必要

### ツール分類

- **Vitest**: 既存のテストフレームワークで自動テスト可能
- **外部ツール**: 専用ツール（WebAIM Contrast Checker、axe-core等）が必要
- **手動テスト**: 人間による視覚的確認やユーザビリティテストが必要

## 実行指示

### 生成時の手順

1. **コンポーネント名を受け取ったら**、そのUI要素の性質（操作／視覚／状態）を分析
2. **WCAG 2.2 の成功基準一覧から関連項目を抽出**
3. **各項目について「なぜ含めたのか」を説明できる形で再構成**
4. **Markdown形式で完全に整形された仕様書として出力**

### 更新時の手順

1. **テスト実装・実行後**、確認状況を更新
2. **改善実装後**、再テストを実施し結果を反映
3. **更新履歴**に変更内容を追記

## 参照ドキュメント

- [W3C公式 WCAG 2.2 勧告 (2023-10-05)](https://www.w3.org/TR/WCAG22/)
- WAI-ARIA Authoring Practices 1.2
- Gov.uk Design System Accessibility Checklist
- Material Design Accessibility Guidelines
- 既存例: `docs/component/button-accessibility-specification.md`

## 運用ルール

- 新規コンポーネント作成時は、仕様書と同時にアクセシビリティ仕様書も作成
- アクセシビリティ要件の変更時は、同一PRで仕様書を更新
- テスト実装後は必ず確認状況を更新
- AAAレベル項目は推奨として扱い、AAレベル達成後に検討
